<div class="search-container">
  <h2>Find accommodations</h2>

  <form [formGroup]="form" (ngSubmit)="onSearch()" class="filters">
    <div class="filters-row" fxLayout="row" fxLayoutGap="16px" fxLayoutAlign="start center">
      
      <mat-form-field appearance="outline">
        <mat-label>Location</mat-label>
        <input matInput placeholder="City or name" formControlName="location">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Guests</mat-label>
        <input matInput type="number" min="1" formControlName="guests">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Start Date</mat-label>
        <input matInput [matDatepicker]="startPicker" formControlName="start">
        <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
        <mat-datepicker #startPicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>End Date</mat-label>
        <input matInput [matDatepicker]="endPicker" formControlName="end">
        <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
        <mat-datepicker #endPicker></mat-datepicker>
      </mat-form-field>

      <button mat-raised-button color="primary" type="submit">Search</button>
    </div>
  </form>

  <div class="loading" *ngIf="loading">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    Searching...
  </div>

  <div *ngIf="results?.length">
    <table mat-table [dataSource]="results" class="mat-elevation-z8 results-table">

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> Accommodation </th>
        <td mat-cell *matCellDef="let a"> {{ a.name }} </td>
      </ng-container>

      <ng-container matColumnDef="location">
        <th mat-header-cell *matHeaderCellDef> Location </th>
        <td mat-cell *matCellDef="let a"> {{ a.location }} </td>
      </ng-container>

      <ng-container matColumnDef="guests">
        <th mat-header-cell *matHeaderCellDef> Guests (min-max) </th>
        <td mat-cell *matCellDef="let a"> {{ a.minGuestNumber }} - {{ a.maxGuestNumber }} </td>
      </ng-container>

      <ng-container matColumnDef="conveniences">
        <th mat-header-cell *matHeaderCellDef> Conveniences </th>
        <td mat-cell *matCellDef="let a"> {{ showConveniences(a) }} </td>
      </ng-container>

      <ng-container matColumnDef="unitPrice">
        <th mat-header-cell *matHeaderCellDef> Price per night </th>
        <td mat-cell *matCellDef="let a">
          <ng-container *ngIf="calculatePrices(a, form.value.start, form.value.end, form.value.guests) as p">
            {{ p.unitPrice | number:'1.0-2' }}
            <span *ngIf="p.priceType === PriceType.PER_GUEST"> (per guest / night)</span>
            <span *ngIf="p.priceType === PriceType.PER_UNIT"> (per unit / night)</span>
          </ng-container>
        </td>
      </ng-container>

      <ng-container matColumnDef="totalPrice">
        <th mat-header-cell *matHeaderCellDef> Total price </th>
        <td mat-cell *matCellDef="let a">
          <ng-container *ngIf="calculatePrices(a, form.value.start, form.value.end, form.value.guests) as p">
            {{ p.total | number:'1.0-2' }}
          </ng-container>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

  <div *ngIf="!results?.length && !loading">No accommodations found for your criteria.</div>
</div>
